<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "=//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eljamdev.service.mapper.BBSMapper">
	
	<select id="getBBS" resultType="HashMap">
		select 
		    idx
		   ,title
		   ,count
		   ,writer
		from bbs
		 where 
			useyn = 'Y'
			and category = #{category}

		<if test="searchType=='title' and keyword != null and keyword != '' ">
			and title like concat('%', #{keyword}, '%')
		</if>
		<if test="searchType=='contents' and keyword != null and keyword != '' ">
			and contents like concat('%', #{keyword}, '%')
		</if>
		<if test="searchType=='writer' and keyword != null and keyword != '' ">
			and writer like concat('%', #{keyword}, '%')
		</if>
		
		 order by idx desc 
		 limit #{startList}, #{listSize}
	</select>
	
	<select id="getBBSInfo" parameterType="int" resultType="HashMap">
		select idx, title, CONVERT(contents USING utf8) as contents, writer from bbs where idx = #{idx}
	</select>
	
	<select id="getBBSCnt" resultType="int">
		select
			count(*) as listCnt
		from
			bbs
			where useyn = 'Y'
			and category = #{category}
			
		<if test="keyword != null and keyword != '' ">
				<if test="searchType=='title'">
					and title like concat('%', #{keyword}, '%')
				</if>
				<if test="searchType=='contents'">
					and contents like concat('%', #{keyword}, '%')
				</if>
				<if test="searchType=='writer'">
					and writer like concat('%', #{keyword}, '%')
				</if>
	      </if>
	</select>
	
	<update id="insertBBS" parameterType="HashMap">
		insert into bbs (title, contents, writer, regdate, useyn, category) values (#{title}, #{contents}, #{writer}, NOW(), 'Y', #{category})
	</update>
	
	<update id="deleteBBS" parameterType="HashMap">
		update bbs set useyn = 'N' where idx = #{idx} 
	</update>
	
	<update id="updateBBS" parameterType="HashMap">
		update bbs set 
			title = #{title}
		   ,contents = #{contents}
		   ,moddate = NOW()
		where idx = #{idx} 
	</update>
	
	<update id="updateBBSCount" parameterType="int">
		update bbs set 
			count = count + 1
		where idx = #{idx} 
	</update>
	
</mapper>
